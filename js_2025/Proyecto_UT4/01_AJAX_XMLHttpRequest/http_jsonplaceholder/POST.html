<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>POST AJAX Mejorado</title>
</head>
<body>

    <!-- Botón para crear un nuevo post -->
    <button onclick="send_with_ajax()">Crear Post</button>
    <br>
    <!-- Contenedor donde se mostrarán los resultados -->
    <div id="resultados"></div>

    <script>
        function send_with_ajax() {
            var apiUrl = 'https://jsonplaceholder.typicode.com/posts';
            var resultados = document.getElementById("resultados");

            // Datos a enviar en formato JSON
            var data = JSON.stringify({
                title: 'Jose',
                body: 'Acosta',
                userId: 1
            });

            var xhr = new XMLHttpRequest();

            // Evento cuando la petición carga correctamente
            xhr.onload = function() {
                if (xhr.status === 201) { // 201 = Created
                    try {
                        var post = JSON.parse(xhr.responseText);
                        console.log('Respuesta del servidor:', post);

                        // Mostramos el post creado de forma legible
                        resultados.innerHTML = '<pre>' + JSON.stringify(post, null, 2) + '</pre>';
                    } catch (error) {
                        console.error('Error al parsear JSON:', error);
                        resultados.textContent = 'Error al procesar la respuesta del servidor.';
                    }
                } else {
                    console.error('Error en la solicitud. Status:', xhr.status);
                    resultados.textContent = 'Ocurrió un error al crear el post.';
                }
            };

            // Evento si ocurre un error de red
            xhr.onerror = function() {
                console.error('Ocurrió un error en la conexión.');
                resultados.textContent = 'Ocurrió un error, no se pudo procesar la solicitud.';
            };

            // Inicializamos la solicitud POST
            xhr.open('POST', apiUrl, true);
            xhr.setRequestHeader('Content-Type', 'application/json');

            // Enviamos los datos
            xhr.send(data);
        }
    </script>

</body>
</html>
